# **Naviga — Product Core**

## **1\. Что мы строим**

**Naviga** — система автономной групповой навигации и обмена координатами **вне мобильных сетей**, рассчитанная на outdoor-сценарии (охота, походы, поиски и т.п.). Основной пользовательский интерфейс — **мобильное приложение**, основной канал связи между участниками — **радиосеть через донглы**.

Цель ближайшего этапа: **работающий фундамент** “из коробки” (OOTB), который:

* запускается быстро,  
* демонстрирует полный end-to-end цикл,  
* становится базой для “слоёв” (охота, роли, mesh, JOIN).

---

## **2\. Базовые определения (термины)**

### **2.1. Нода (Node)**

Физическое устройство Naviga (донгл или маяк/ошейник в будущем), участвующее в радиосети и обменивающееся данными.

### **2.2. Донгл (Dongle)**

Нода, которая:

* подключается к смартфону по **Bluetooth (BLE)**,  
* является радиомодемом (LoRa/аналог),  
* передаёт/принимает пакеты и “мостит” их в приложение.

### **2.3. Приложение (Mobile App)**

UI и “мозг продукта”:

* карта,  
* список нод,  
* лог/трек,  
* настройки донгла,  
* позже: сценарии (охота и т.д.).  
   Вижн-документ проекта «Навига» …

### **2.4. OOTB (Out of the Box)**

Базовый режим работы, доступный всем, **без охоты, без ролей, без JOIN, без mesh-оптимизаций**. Он должен быть самодостаточным продуктом.

Навига \_Out of the box\_ и актив…

---

## **3\. Продуктовые режимы (слойность)**

### **3.1. OOTB (базовый слой) — делаем первым**

* Ноды периодически шлют простой геопакет.  
* Любая нода ведёт список известных нод (NodeTable).  
* Донгл отдаёт NodeTable в телефон.  
* Приложение показывает ноды на карте и в списке.  
   Навига \_Out of the box\_ и актив…

### **3.2. Охота (надстройка) — позже**

* Сессия, Session Master, раздача short\_id, anchor.  
* Роли, интервалы, JOIN/ACCEPT.  
* Mesh-логика для масштабирования (covered\_mask/best\_mask).

---

## **4\. OOTB v0 — целевой первый “большой шаг” (Definition of Done)**

### **4.1. Что умеет железка (донгл/нода) в OOTB v0**

1. **BLE связь с телефоном**  
* подключение/переподключение  
* базовые настройки (частота/канал/интервал/мощность — минимально)  
2. **Радио обмен**  
* периодически отправляет `GEO_BEACON` со своими координатами  
* принимает `GEO_BEACON` других  
3. **NodeTable**  
* хранит последние данные по известным нодам:  
  * id (пока long\_id)  
  * last\_seen  
  * last\_pos (lat/lon\[/alt\])  
  * RSSI/SNR последнего приёма  
  * battery (если передаём)  
* помечает ноды “устаревшими” по таймауту  
4. **Мост в мобильное приложение**  
* отдаёт снапшот NodeTable и/или события обновлений по BLE

### **4.2. Что умеет мобильное приложение в OOTB v0**

* подключиться к донглу по BLE  
* показать список видимых нод (с давностью, RSSI/SNR, батареей)  
* показать ноды на карте  
* показать “я” (позицию телефона, если разрешено)  
* базовый локальный лог (минимально)

### **4.3. Жёсткие не-цели OOTB v0 (чтобы не расползлось)**

* никакого short\_id  
* никакого JOIN/Session Master  
* никакого mesh covered\_mask/best\_mask  
* никакого backend  
* никакой “охоты” в UX

---

## **5\. Архитектура системы (контейнеры)**

**Mobile App** ⇄(BLE)⇄ **Dongle** ⇄(Radio)⇄ **Другие ноды**

* BLE: управление \+ данные NodeTable  
* Radio: обмен геопакетами (в OOTB v0 — простейший beacon)

---

## **6\. Протоколы: что существует уже сейчас как концепт**

### **6.1. JOIN (для охоты, позже)**

JOIN — механизм присоединения к сессии с Session Master, выдача short\_id и anchor для дельта-координат.

Неформальное описание логики пр…

### **6.2. Mesh (для охоты/масштабирования, позже)**

Концепция распространения геопакетов через покрывающую маску (covered\_mask) и объединённую best\_mask для уменьшения лишних ретрансляций.

Навига Mesh\_ концептуальная спе…

---

## **7\. Аппаратная часть (минимальная рамка, без углубления)**

Сейчас важно зафиксировать минимальный принцип:

* донгл \= BLE \+ радио \+ питание (+ возможно GNSS)  
* маяк/ошейник — позже, в OOTB v0 не обязателен (можно вторую “ноду” как донгл без телефона).  
   Вижн-документ проекта «Навига» …

---

## **8\. Дорожная карта (минимальная, инженерная)**

### **Milestone M0 — Док-ядро и карта проекта**

* Product Core (этот документ)  
* Architecture Index (карта файлов/уровней)  
* OOTB Radio v0 spec  
* OOTB BLE v0 spec  
* Test Plan v0

### **Milestone M1 — OOTB End-to-End v0**

* firmware: радио beacon \+ nodetable \+ BLE API  
* mobile: BLE \+ list \+ map  
* полевой тест: 2–5 нод

### **Milestone M2 — Сценарий “Охота” v1 (надстройка)**

* JOIN/SM/anchor  
* роли  
* mesh (минимальная интеграция)

---

## **9\. Статус существующих документов**

* Vision (Decision Edition) — **историческая база \+ чеклист** (статус: `archive+reference`)  
   Вижн-документ проекта «Навига» …  
* OOTB письмо — источник принципов, вшито в OOTB разделы (статус: `draft/reference`)  
   Навига \_Out of the box\_ и актив…  
* JOIN — спецификация для охоты (статус: `active/future`)  
   Неформальное описание логики пр…  
* Mesh — спецификация протокола (статус: `active/future`)  
   Навига Mesh\_ концептуальная спе…

---

## **10\. Следующий шаг после принятия этого документа**

1. Создать `OOTB Radio v0` (один тип пакета \+ правила частоты/TTL/stale)  
2. Создать `OOTB BLE v0` (GATT \+ формат снапшота NodeTable)  
3. Нарезать Epic “OOTB end-to-end v0” на задачи под Cursor с жёстким scope

