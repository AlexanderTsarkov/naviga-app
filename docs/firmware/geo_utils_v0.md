# Geo utils v0 (OOTB seed)

**Purpose:** Канонические типы и API для расстояния и азимута между точками в прошивке OOTB v0. Вышележащие слои (cadence, beacon, NodeTable) используют только этот контракт; реализация может быть заменена без изменения вызывающего кода.

**Related:** [GNSSSnapshot / lat_e7, lon_e7](hal_contracts_v0.md#31-gnssprovider-abstraction--enum-and-struct), [Beacon cadence (min_movement_m)](../protocols/ootb_radio_v0.md#4-beacon-cadence-seed).

---

## 1. Decisions (seed)

- **Модель:** используется **локальная плоская аппроксимация (equirectangular)** для расстояния и bearing. Искривление Земли не моделируется.
- **Обоснование:** ожидаемое применение — локальное (охота, лес), расстояния обычно в пределах нескольких–десятков км; точности достаточно, вычисления быстрые.

**Future:** реализацию можно заменить на Haversine или ENU без изменения контракта и вызывающих слоёв.

---

## 2. Canonical types

**GeoPoint** — единственная каноническая точка для seed:

| Поле | Тип | Описание |
|------|-----|----------|
| **lat_e7** | int32 | Широта × 1e7 (микрограды). |
| **lon_e7** | int32 | Долгота × 1e7 (микрограды). |

Совместимо с полями GNSSSnapshot (lat_e7, lon_e7) и с координатами в NodeTable / GEO_BEACON.

---

## 3. Canonical API

Вышележащие слои (cadence, beacon, NodeTable) вызывают **только** эти функции; не зависят от выбора проекции внутри реализации.

| Функция | Сигнатура | Описание |
|---------|-----------|----------|
| **geo_distance_m** | (a: GeoPoint, b: GeoPoint) → float | Расстояние между точками в **метрах**. |
| **geo_bearing_deg** | (a: GeoPoint, b: GeoPoint) → float | Азимут от a к b в **градусах**, диапазон **[0, 360)**. |
| **geo_distance_bearing** | (a: GeoPoint, b: GeoPoint) → { dist_m, bearing_deg } | Опционально: одна функция, возвращающая и расстояние, и bearing (удобно при одновременном использовании). |

---

## 4. Implementation notes

- **Внутри реализации:** конвертация **e7 → радианы** (или локальные метры по equirectangular) выполняется в реализации; вызывающий код передаёт только GeoPoint в e7.
- **Bearing:** вычисляется из тех же входных данных локальной проекции, что и расстояние — согласованная аппроксимация (equirectangular: разница широт/долгот в подходящих единицах).
- **Future:** замена на Haversine (сферическая Земля) или ENU (локальная касательная плоскость) не меняет сигнатуры и не требует правок в cadence/NodeTable/beacon.

Без кода — только контракт и решения; конкретные формулы equirectangular — в реализации.
